<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Bootstrap demo</title>

     <section id="CSS-primaryRepository">
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
               integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

          <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
               integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

          <link rel="stylesheet" href="/static/css/card.css">
          <link rel="stylesheet" href="/static/css/pagination.css">
          <link rel="stylesheet" href="/static/css/map.css">
          <link rel="stylesheet" href="/static/css/style.css">
     </section>
</head>
<body class="body-map-page">

     <header>
          {% include "components/navbar.html.jinja" %}
     </header>


     <main class="main-map-container">

          <aside class="aside-browser">
               <header class="header-browser-searchbar">
                    {% with current_route = "/map"%}
                         {% include "components/search_bar.html.jinja" %}
                    {% endwith %}
                    <button id="accordion-miniBrowser-toogleBtn" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-miniBrowser" aria-expanded="true" aria-controls="collapseOne" onclick="change_accordionToggleIcon('accordion-miniBrowser-toogleBtn', 'miniBroswerAccordionToggleIcon_id')">
                         <img id="miniBroswerAccordionToggleIcon_id" src="/static/images/svgs/arrow_down.svg">                       
                    </button>
               </header>

               <div id="accordion-miniBrowser" class="accordion-collapse collapse {% if search_input or paginationInput_boolean %}show{% endif %}">
                    {% include "components/browser_body.html.jinja" %}
               </div>

          </aside>

          <div id="map"></div>
     
     </main>


     <section id="JavaScript-primaryRepository">
          <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="">
          </script>
          
          <script>
               var results = {{browser_publicData["results"] | tojson}}
               console.log(results)
               var searches = {{browser_publicData["results"]["searches"] | tojson}}
               var favorites = {{browser_publicData["results"]["favorites"] | tojson}}
               var recommendations = {{browser_publicData["results"]["recommendations"] | tojson}}



               var map = L.map('map').setView([51.505, -0.09], 13);
               var vaild_sections = ["recommendations"]
               if (Boolean(searches)) {
                    vaild_sections.push("searches")
               }
               if (Boolean(favorites)) {
                    vaild_sections.push("favorites")
               }
               console.log(vaild_sections)
               


               for (let section in vaild_sections) {
                    console.log(section)
                    console.log(results[section])
                    for (let restaurant of results[section]) {
                         const lat = restaurant["lat"]
                         const lng = restaurant["lng"]
                         const name = restaurant["name"]
                         const description = restaurant["description"]
                         const image = restaurant['image']
                         console.log(lat)
                         console.log(lng)
                         console.log(name)
                         console.log(description)
                         console.log(image)
                         console.log("image")

                         L.marker([lat,lng]).addTo(map)
                         .bindPopup(`${name} ${description} <img src="${image}" class="card-img-top md" alt="${name}">`)
                         .openPopup();
                    }
               }




               L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
               }).addTo(map);

          </script>

          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

          <script src="../static/javascript/script.js"></script>          
     </section>
</body>
</html>

