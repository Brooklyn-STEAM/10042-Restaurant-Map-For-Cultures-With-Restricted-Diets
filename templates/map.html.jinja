<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Bootstrap demo</title>

     <section id="CSS-primaryRepository">
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
               integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

          <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
               integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

          <link rel="stylesheet" href="/static/css/browser.css">
          <link rel="stylesheet" href="/static/css/map.css">
          <link rel="stylesheet" href="/static/css/style.css">
     </section>
</head>
<body class="body-map-page">

     <header>
          {% include "components/navbar.html.jinja" %}
     </header>


     <main class="main-map-container">
          <aside class="accordion aside-browser" id="miniBrowser">
               {% if browser_publicData["given_filter"] %}
               <article class="accordion-item OE-bg-img-cloudly-blue">
                         <header class="accordion-header">
                              {% with current_route = "/map"%}
                                   {% include "components/search_bar.html.jinja" %}
                              {% endwith %}
                              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#miniBrowserBody" aria-expanded="true" aria-controls="miniBrowserBody">
                              Browser
                              </button>
                         </header>
                         <section id="miniBrowserBody" class="accordion-collapse collapse show" data-bs-parent="#miniBrowser">
                              <div class="accordion-body">
                                   {% include "components/browser_body.html.jinja" %}
                              </div>
                         </section>
               </article>
               {% else %}
                    <article class="accordion-item OE-bg-img-cloudly-blue">
                         <header class="accordion-header">
                              {% with current_route = "/map"%}
                                   {% include "components/search_bar.html.jinja" %}
                              {% endwith %}
                              <button class="bg-info-subtle accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                              Browser
                              </button>
                         </header>
                         <section id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                              <div class="accordion-body">
                                   {% include "components/browser_body.html.jinja" %}
                              </div>
                         </section>
                    </article>
               {% endif %}
          </aside>

          <div id="map"></div>
     </main>


     <section id="JavaScript-primaryRepository">
          <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="">
          </script>
          
          <script>

               {# function show_markers(section) {
                    let shown_markers = results[section];
                    console.log(shown_markers);
               } #}
               var map = L.map('map').setView([40.7529, -73.8163], 13);
               L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
               }).addTo(map);

               const results = {{ browser_publicData["results"] | tojson }};

               {# Load Markers #}

               for (let key in results) {
                    restoData_list = results[key]

                    if (restoData_list.length > 0) {
                         for (let key in restoData_list) { 
                              resto = restoData_list[key]
    
                              const lat = Number(resto["lat"])
                              const lng = Number(resto["lng"])
                              const name = resto["name"]
                              const description = resto["description"]
                              const image = resto['image']
                              latlng = [lat, lng]
                              
                              L.marker(latlng).addTo(map)
                              .bindPopup(`${name} ${description} <img src="${image}" class="card-img-top md" alt="${name}">`)
                              .openPopup();
                         }
                    }

               }

          </script>

          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

          <script src="static/javascript/script.js"></script>          
     </section>
</body>
</html>

